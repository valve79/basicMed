<div ng-controller="materials.EditMaterialController as vm"><div class="col-lg-12 col-xs-12"><i class="vhs-purple-text">* Required fields</i></div><form class="form-horizontal" ng-submit="vm.saveOrUpdateMaterial(vm.material, vm.permissionsWithUsersAndGroups)" id="material_form" name="material_form"><div class="col-lg-6 col-sm-6 col-xs-12"><div class="form-group"><div class="col-lg-4 col-xs-4 control-label"><label class="vhs-required">Subject</label></div><div class="col-sm-8 col-xs-8 pull-right"><div reference-dropdown-selector vhs-reference-name="'subjects'" vhs-model="vm.material" vhs-model-property="'subjectId'" vhs-element-name="subjectField" vhs-nullable="true" vhs-required="true" vhs-editable="true" vhs-on-change="vm.materialSubjectChangeCallback(name)"/><span class="error" ng-show="material_form.subjectField.$error.required">Please specify a subject</span></div></div><div class="form-group"><label for="nameField" class="col-sm-4 col-xs-4 control-label vhs-required">Title</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="nameField" name="nameField" ng-model="vm.material.title" maxlength="255" required> <span class="error" ng-show="material_form.nameField.$error.required">Please specify a material title</span></div></div><div class="form-group"><label for="authorField" class="col-sm-4 col-xs-4 control-label">Author</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="authorField" name="authorField" ng-model="vm.material.author" maxlength="255"></div></div><div class="form-group"><label for="topicField" class="col-sm-4 col-xs-4 control-label vhs-required">Topic</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="topicField" name="topicField" ng-model="vm.material.topic" maxlength="255" required> <span class="error" ng-show="material_form.topicField.$error.required">Please specify a material topic</span></div></div><div class="form-group"><label for="summaryField" class="col-sm-4 col-xs-5 control-label">Summary</label><div class="col-sm-8 col-xs-8 pull-right"><textarea type="text" class="form-control" id="summaryField" name="summaryField" maxlength="2000" rows="3" ng-model="vm.material.summary"></textarea></div></div><div class="form-group"><label for="previewField" class="col-sm-4 col-xs-4 control-label">Thumbnail</label><div class="col-sm-8 col-xs-8"><div ng-if="vm.preview || vm.previewUrl"><div class="hover-btn"><button id="previewField" type="button" class="close" data-dismiss="alert" title="Удалить" ng-click="vm.resetPreview()"><span aria-hidden="true">×</span> <span class="sr-only">Удалить</span></button></div><img class="img-preview" ngf-src="vm.preview" ngf-background="vm.preview"> <img class="img-preview" ngf-src="vm.previewUrl" ngf-background="vm.previewUrl" ng-if="vm.materialId && !vm.preview"></div><div class="input-group"><span class="fileUpload btn btn-block vhs-green vhs-white-text" ng-disabled="vm.disabledUploadButton" ng-if="!vm.preview && !vm.previewUrl"><span>Upload</span> <input id="previewField" type="file" class="upload" ngf-select ng-model="vm.preview" ngf-pattern=".jpg,.png,.bmp" name="uploadPreviewField" value="Upload"/></span></div><button class="btn btn-default" type="button" ng-click="vm.restorePreviewUrl()" ng-if="vm.hasPreviewUrlCanceled">Отменить</button> <span class="error" ng-show="material_form.uploadPreviewField.$error.pattern">Invalid file format. Please select a file with .jpg, .png, or .bmp extension</span></div></div><div class="form-group"><label for="materialTypeField" class="col-lg-4 col-xs-4 text-uppercase vhs-required control-label">Attach</label><div class="col-sm-8 col-xs-8 pull-right" id="materialTypeField"><div class="col-lg-6 col-xs-12"><div class="input-group"><div class="radio"><label for="fileTypeField"><input id="fileTypeField" type="radio" ng-value="1" ng-model="vm.uploadContentType" ng-change="vm.setFileOrLinkType()"> File</label></div></div></div><div class="col-lg-6 col-xs-12"><div class="input-group"><div class="radio"><label for="linkTypeField"><input id="linkTypeField" type="radio" ng-value="2" ng-model="vm.uploadContentType" ng-change="vm.setFileOrLinkType()"> Link</label></div></div></div></div></div><div class="form-group" ng-if="vm.uploadContentType == 2"><label for="linkField" class="col-sm-4 col-xs-4 control-label vhs-required">URL</label><div class="col-sm-8 col-xs-8 pull-right"><input type="url" class="form-control" id="linkField" name="linkField" ng-model="vm.material.link" ng-click="vm.enableButtonForLinkUpload()" maxlength="255" required> <span class="error" ng-show="material_form.linkField.$error.required">Please specify a URL</span> <span class="error" ng-show="material_form.linkField.$error.url">Invalid URL format: it should start with http://… or https://…</span></div></div><div class="form-group" ng-if="vm.materialId && vm.typeId != 3 && vm.material.fileStatus"><label for="fileField" class="col-sm-4 col-xs-4 control-label">File</label><div class="col-sm-8 col-xs-8 pull-right"><div class="input-group" ng-if="!vm.showUploadButton"><input id="fileField" type="text" class="form-control" ng-model="vm.fileName" disabled="disabled"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="vm.reupload()">Upload another file</button></span></div><button id="fileField" class="btn btn-default" type="button" ng-click="vm.reupload()" ng-if="vm.showUploadButton">Cancel</button> <span class="error" ng-show="vm.material.fileStatus == 'EMPTY'">The file is not loaded or processing</span></div></div></div><div class="col-lg-6 col-sm-6 col-xs-12"><div class="form-group"><label for="ownerField" class="col-lg-4 col-sm-5 col-xs-4 control-label">Owner</label><div class="col-lg-8 col-sm-7 col-xs-8 pull-right"><select class="form-control" id="ownerField" name="ownerField" ng-model="vm.material.ownerId" ng-required="true" ng-options="::w.id as ::w.name for w in ::vm.owners" ng-change="vm.materialOwnerChangeCallback()"></select> <span class="error" ng-show="material_form.ownerField.$error.required">Please specify a material owner</span></div></div><div class="form-group"><label for="priceField" class="col-lg-4 col-sm-5 col-xs-4 control-label">Price</label><div class="col-lg-8 col-sm-7 col-xs-8 pull-right"><input type="number" step="0.01" pattern="\d?\d+\.?\,?\d{0,2}" class="form-control" id="priceField" name="priceField" ng-model="vm.material.price" min="0" max="9007199254740992"> <span class="error" ng-show="material_form.priceField.$error.number">Please enter a number </span><span class="error" ng-show="material_form.priceField.$error.min">Please enter a non-negative number </span><span class="error" ng-show="material_form.priceField.$error.max">This number is too big</span></div></div><div class="form-group"><label for="conditionsOfUseField" class="col-sm-4 col-xs-4 control-label" style="padding-top: 0;">Terms of use</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="conditionsOfUseField" name="conditionsOfUseField" ng-model="vm.material.conditionalOfUse" maxlength="255"></div></div><div class="form-group"><label class="col-sm-4 col-xs-4 control-label">Expiration of content viewing permissions</label><div class="col-sm-8 col-xs-8 form-inline pull-right"><div class="radio-inline col-lg-1 col-sm-12"><label for="inPerpetuityField" class="control-label material-validity-label"><input id="inPerpetuityField" type="radio" ng-value="true" ng-model="vm.isValidityInPerpetuity" ng-click="vm.cleanValidity()"> Never expires</label></div><div class="radio-inline form-inline pull-right"><label for="validityInPerpetuityFieldId" for="validityInPerpetuityFieldId" class="control-label material-validity-label"><input id="validityInPerpetuityFieldId" type="radio" ng-value="false" ng-model="vm.isValidityInPerpetuity"> To</label> <label class="sr-only" for="validityDateToFieldId">Expiration of content viewing permissions</label> <input date-picker ng-disabled="vm.isValidityInPerpetuity" type="text" size="10" class="form-control pull-right material-validity-datepicker" ng-model="vm.material.validityText" id="validityDateToFieldId" name="validityInPerpetuityField" ng-pattern="/^(0?[1-9]|1[012])\/(0?[1-9]|[12][0-9]|3[01])\/((18|19|20)\d{2})$/"/><div><span class="error" ng-show="material_form.validityInPerpetuityField.$error.pattern">Invalid date format</span></div></div></div></div><div class="form-group"><label for="languageField" class="col-sm-4 col-xs-4 control-label vhs-required">Language</label><div class="col-sm-8 col-xs-8"><div id="languageField" reference-dropdown-selector vhs-reference-name="'languages'" vhs-model="vm.material" vhs-model-property="'languageId'" vhs-element-name="languageField" vhs-nullable="true" vhs-required="true" vhs-editable="true" vhs-on-change="vm.materialLanguageChangeCallback(name)"/><span class="error" ng-show="material_form.languageField.$error.required">Please specify a language of the material</span></div></div><div class="form-group"><label for="tagsField" class="col-sm-4 col-xs-4 control-label">Tags</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="tagsField" name="tagsField" ng-model="vm.material.tags" maxlength="255"></div></div><div class="form-group"><label for="commentField" class="col-sm-4 col-xs-4 control-label">Comments</label><div class="col-sm-8 col-xs-8 pull-right"><textarea id="commentField" type="text" class="form-control" maxlength="4000" rows="3" ng-model="vm.material.comment"></textarea></div></div><div class="form-group"><div class="col-sm-4 col-xs-4"></div><div class="col-sm-8 col-xs-8"><button class="btn btn-default btn-block btn-xs" type="button">Check the spelling</button> <button class="btn btn-default btn-block btn-xs" type="button" ng-click="vm.showPreview()">Preview</button><div class="row form-btn-uploads"><div class="col-lg-6 col-xs-6"><button class="btn btn-block btn-xs vhs-green vhs-white-text" type="submit" ng-disabled="!material_form.$valid || !vm.typeId || vm.disabledSaveButton">Save</button></div><div class="col-lg-6 col-xs-6"><button class="btn btn-block btn-xs vhs-brown vhs-white-text" type="button" ng-click="vm.redirectOrClearFields()">Cancel</button></div></div></div></div></div><div class="form-group" ng-if="vm.showUploadButton && vm.uploadContentType != 2"><div class="row"><div class="col-sm-offset-5 col-sm-2 col-xs-offset-5 col-xs-3 text-center"><div class="fileUpload btn btn-block vhs-green vhs-white-text" ng-click="vm.enableButton()" ng-disabled="vm.disabledUploadButton"><span>Upload</span> <input type="file" class="upload" ngf-select ng-model="vm.file" ngf-change="vm.setMaterialType()" ngf-pattern=".mp3,.mp4,.txt,.doc,.docx,.ppt,.pptx,.jpg,.png,.pdf,.xls,.xlsx" ng-required="vm.typeId != 3" id="uploadFileField" name="uploadFileField" title="Upload"></div><span class="error" ng-show="material_form.uploadFileField.$error.required">Attach a file</span> <span class="error" ng-show="material_form.uploadFileField.$error.pattern">Invalid file format</span> <span id="infoField" class="collapse vhs-orange-text"><p>Please select a file with .mp3, .mp4, .txt, .doc, .docx, .ppt, .pptx, .jpg, .png, .pdf, .xls, .xlsx</p></span></div><div class="col-sm-1 col-xs-1 icon-file-type-info"><span class="glyphicon glyphicon-question-sign vhs-green-text" data-toggle="collapse" data-target="#infoField" aria-controls="infoField"></span></div></div></div><div class="col-lg-12"><div class="form-group" ng-if="vm.permissionsWithUsersAndGroups.length > 0"><div users-and-groups-selector vhs-object-model="vm" vhs-object-model-property="'material'" vhs-current-user-id-model="vm.material" vhs-current-user-id-model-property="'ownerId'" vhs-current-user-name-model="vm.material" vhs-current-user-name-model-property="'ownerName'" vhs-permissions-with-users-and-groups-model="vm.permissionsWithUsersAndGroups"></div></div></div></form><div class="modal fade" id="previewDialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Preview for material «{{vm.material.title}}»</h4></div><div class="modal-body"><div ng-if="vm.hasFile"><div ng-if="vm.typeId == 1"><audio controls ngf-src="vm.file"></audio></div><div ng-if="vm.typeId == 2"><video controls ngf-src="vm.file" width="100%" height="100%"></video></div><div ng-if="vm.typeId == 4"><img class="material-download" ngf-src="vm.file" width="100%" height="100%"></div></div><div ng-if="!vm.hasFile && vm.isMaterialFileStatusReady"><div ng-if="vm.isAudioOrVideo"><div vhs-thumbnail vhs-thumbnail-model="vm.material"></div><div vhs-video vhs-sources="vm.multimediaSources" vhs-width="'100%'" vhs-height="'300px'" vhs-poster="vm.previewUrl" vhs-error-callback="vm.multimediaErrorCallback(code, message)"></div></div><div class="material-download" ng-if="vm.isPhoto"><img ng-src="{{vm.material.downloadUrl}}" width="100%" height="100%"></div></div><div ng-if="vm.isYoutube"><div vhs-youtube-video vhs-sources="vm.youtubeMultimediaSources" vhs-width="'100%'" vhs-height="'300px'" vhs-poster="vm.material.previewUrl" vhs-error-callback="vm.multimediaErrorCallback(code, message)"></div></div><div class="col-lg-12 col-md-12 col-xs-12 vhs-brown vhs-white-text material-name"><div class="col-lg-8 col-md-8 col-xs-6"><span ng-bind="vm.material.title"></span></div></div><div class="col-lg-12 col-md-12 col-xs-12 material-container"><div class="row"><div class="col-lg-4 col-md-4 col-xs-4"><h6><strong>Subject:</strong> <span ng-bind="vm.material.subjectName"></span></h6><h6><strong>Title:</strong> <span ng-bind="vm.material.title"></span></h6><h6><strong>Topic:</strong> <span ng-bind="vm.material.topic"></span></h6><h6><strong>Author:</strong> <span ng-bind="vm.material.author"></span></h6><h6><strong>Available till:</strong> <span ng-bind="(vm.getMaterialValidity())
                                        ? vm.material.validity
                                        : 'Never expires'
                                        | date: 'M/d/yyyy'"></span></h6><h6><strong>Language:</strong> <span ng-bind="vm.material.languageName"></span></h6><h6><strong>Owner:</strong> <span ng-bind="vm.material.ownerName"></span></h6></div><div class="col-lg-8 col-md-8 col-xs-8"><h6><strong>Summary:</strong></h6><h6><span ng-bind="vm.material.summary"></span></h6></div></div></div><button type="button" class="btn vhs-green vhs-white-text pull-right" data-dismiss="modal" ng-click="vm.stopVideoAndAudioOnHidePreview()">Return to edit</button></div></div></div></div></div>