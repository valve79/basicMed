<div ng-controller="auth.LogOnController as vm">
  <div ng-include="::vm.url.template('common/_page-styles.html')"></div>
  <style type="text/css">
    .tcMed .tcMedHero .tcMedHeroContent {
      padding-top: 45px;
    }
.top-links {
  position: absolute;
  top: 10px;
  right: -100px;
  z-index: 10000;
  font-size: 0.9em;
}

.top-links span {
  display: flex;
  gap: 5px; /* adds spacing between links */
  align-items: center;
  white-space: nowrap;
}

.top-links a {
  text-decoration: none;
  color: #004159;
}

.top-links a:hover {
  text-decoration: underline;
}


    .tcMedTopBar {
      display: none !important;
    }
    .tcMed h1 {
      line-height: normal;
    }
    .renewalLogicBox {
      margin: 2rem 0;
      padding: 1rem;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .renewalLogicBox label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    .renewalLogicBox input[type="date"] {
      padding: 0.5rem;
      margin-top: 0.5rem;
      width: 100%;
      max-width: 300px;
    }
    .renewalLogicBox button {
      margin-top: 1.5rem;
      padding: 0.75rem 1.5rem;
      background: #007cba;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    .renewalLogicBox .recommendation {
      margin-top: 1rem;
      font-size: 1.1em;
      font-weight: bold;
    }
    .tcMed .tcMedHero .tcMedHeroContent img {
    max-width: 90%;
    height: auto;
    -ms-interpolation-mode: bicubic;
}

      .logo-container {
          display: flex;
          align-items: center; /* Vertically centers the content */
      }

      .logo-text {
          margin-left: 20px; /* Adds space between the logo and text */
      }

      .logo-text h1 {
          font-size: 3.7em; /* Adjust the size of the "BasicMed" text */
          margin: 0; /* Removes default margin */
          font-weight: bold;
      }

      .logo-text p {
          font-size: 1.2em; /* Adjust the size of the smaller text */
          margin: 0; /* Removes default margin */
          color: #666; /* Adjust color for the smaller text */
      }

      .tcMed * {
          font-family: 'Lato', sans-serif;
      }




/* Modal styles */
/* Modal background */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 9999; /* Ensure it is on top of all other content */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  background-color: rgba(0, 0, 0, 0.4); /* Black background with opacity */
  overflow: hidden; /* Prevent background from scrolling */
}

/* Modal content */
.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  margin-top: 5%;
  padding: 20px;
  border: 1px solid #888;
  width: 80%; /* Adjust as needed */
  position: relative;
  z-index: 10000; /* Ensure content is above the background */
  max-height: 90vh; /* Prevent modal from growing too tall */
  overflow-y: auto; /* Enable vertical scrolling if content exceeds max height */
  box-sizing: border-box; /* Ensures padding is included in height calculation */
}

/* Close button */
.close-btn {
  color: #aaa;
  font-size: 28px;
  font-weight: bold;
  position: absolute;
  top: 10px;
  right: 25px;
  font-family: Arial, sans-serif;
}

.close-btn:hover,
.close-btn:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}


/* Center step titles */
.step h4 {
  text-align: center;
  font-size: 1.8em;
  margin: 0;
  padding: 0.375rem 0;
}

/* Additional styling for step icons and content */
.step {
  margin-bottom: 20px;
}

.step .icon {
  margin-right: 10px;
  text-align: center;
}

.step img {
  height: 80%;
  margin: 0 auto;
  display: block;
}

.step p {
  font-size: 1em;
  line-height: 1.5;
  margin-top: 10px;
}

/* Optional: You can add an overlay effect to dim the background content */
.modal:before {
  content: "";
  display: block;
  position: absolute;
  background: rgba(0, 0, 0, 0.5); /* Dimmed background */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1; /* Make sure the overlay is behind the modal content */
}

.tcMed .tcMedHero .tcMedHeroContent a,
.tcMed .tcMedHero .tcMedHeroContent button {
  width: 80%;
  margin: 0 auto;
  padding: 7px;
  display: block;
  text-align: center;
  word-wrap: break-word; /* Ensures text wraps within the button */
  word-break: break-word; /* Breaks long words if necessary */
}

.tcMed a.btn {
  color: #fff;
}

.tcMed .button {
  display: inline-block;
  background-color: #0079a5;
  font-size: 13px;
  color: #fff;
  font-weight: bold;
  text-transform: uppercase;
  line-height: 1.846;
  text-align: center;
  text-shadow: 0 2px 3px rgba(0, 0, 0, 0.17);
  padding: 7px 25px;
  border-radius: 10px;
  border: 2px solid #00a3e0;
  text-decoration: none;
  max-width: 100%; /* Ensures the button doesn't exceed its container width */
  box-sizing: border-box; /* Includes padding in the element's total width calculation */
}

/* mobile */
/* Default layout for desktop or larger screens (steps side by side) */
.tcMed .tcMedProcess .tcMonthRenewal {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 20px; /* Optional, adds space between the steps */
}

.tcMed .tcMedProcess .tcMonthRenewal .step {
  width: 22%; /* Adjust this to make sure all steps fit in one row */
  margin-bottom: 20px;
}

/* Mobile view adjustments (stack the steps vertically) */
@media (max-width: 767px) {
  .tcMed .tcMedProcess .tcMonthRenewal {
    flex-direction: column; /* Stack the steps vertically */
    align-items: center; /* Center the content */
  }

  .tcMed .tcMedProcess .tcMonthRenewal .step {
    width: 100%; /* Make each step take up the full width */
    margin-bottom: 20px;
    text-align: center; /* Ensure text is centered */
  }

  .tcMed .tcMedProcess .tcMonthRenewal .step img {
    max-width: 100%; /* Ensure images do not overflow */
    height: auto;
  }
}


.tcMedProcessPage {
  display: flex;
  flex-direction: column;
  gap: 30px;
  max-width: 900px;
}

.tcMedProcessPage .step {
  display: flex;
  align-items: flex-start;
  gap: 20px;
}

.tcMedProcessPage .icon {
  flex: 0 0 auto;
}

.tcMedProcessPage .icon img {
  height: 6em;
  width: auto;
  display: block;
}

.tcMedProcessPage .text {
  flex: 1;
}

.alert-message {
  background: #fff3cd;
  border: 1px solid #ffeeba;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 5px;
  text-align: center; /* Center the text */
}

  </style>
  <div class="tcMedHero">
    <div class="l-wrapper tcMedHeroContent">
      <div class="logo-container">
        <div class="top-links">
          <span>
            <a href="##-B1">Create Account</a> |
            <a href="##-B2">Return Login</a>
          </span>
        </div>
        <img class="logo" style="max-width: 170px;" alt="Medical Self-Assessment | A pilot's guide to flying healthy." src="https://demo-basicmedicalcourse.aopa.org/client/themes/aopa/css/tcMed/aopaLogo.png">
        <div class="logo-text">
            <h1>BasicMed</h1>
            <p>Medical Self-Assessment Course</p>
        </div>
      </div>


      <div class="tcMedHeroSubContainer" style="display: flex; justify-content: space-between; flex-wrap: wrap; margin-bottom: 45px;">


        <!-- LEFT COLUMN -->
        <div class="left" style="flex: 1; min-width: 250px;">
          <p><strong class="orange" style="font-size: 1.2em; margin: 0;">New to BasicMed</strong></p>
          <p style="font-size:1.2em; margin-top: 20px;">The FAA requires this course to have a seperate login from other sites to better secure your medical information.</p>
          <a id="signUpButton" class="button btn btn-register-link" style="width:70%;" href="##-C-NewToBasicMed">Lets Get Started</a>

        </div>
      
        <!-- MIDDLE COLUMN (RENEWAL FORM) -->
        <div class="middle1">
              <!-- Remove ng-submit and ng-controller from the form -->
              <form id="renewalForm"></form>
        </div>
        
        
        
        
      
        <!-- RIGHT COLUMN -->
        <div class="right" style="flex: 1; min-width: 250px; text-align: center;">
          <p><strong class="orange" style="font-size: 1.8em; text-align: center; ">Renewing with BasicMed</strong></p>
          <p style="font-size:1.2em; margin-top: 20px;">We will help make sure you complete the steps to renew ro reinstate your privilidges.</p>
          <a id="signUpButton" class="button btn btn-register-link" style="width:70%;" href="##-C-NewToBasicMed">Start Your Renewal</a>
        </div>
      </div>
    </div>
  </div>

<!-- Modal Structure -->
<div id="stepsModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <div id="renewalSteps"></div>
  </div>
</div>

<!-- Middle Banner -->
  <h1 class="focNotification">
    This <strong>FREE</strong> course is open to everyone, AOPA membership is
    not required to take the course.
  </h1>


  <div class="l-wrapper tcMedContent">
    <div class="contentPanel1">
        <!--START: Lower Page featured copy -->
<div>
	<h1>Welcome to BasicMed</h1>
	<h2>A Smarter Path to Pilot Health Assessment</h2>
	<p>Third class medical reform was an AOPA priority for years, and since 2017 it has been a reality. If you held a regular or special-issuance medical anytime on or after July 15, 2006, you are likely eligible to take advantage of and fly under BasicMed—a simplified alternative to the traditional FAA medical.</p>
	<p>On this page you will find basic information about the program that can help you determine if you're eligible, and we'll guide you through a series of steps to get you to that BasicMed approval.</p>
	<h3>To qualify for BasicMed you must:</h3> 
	<ul>
		<li>Hold a valid U.S. driver's license and comply with any restrictions (for example, corrective lenses, prosthetic aids required, daylight driving only, etc.);</li>
		<li>Have held a valid FAA medical certificate, regular or special issuance, on or after July 15, 2006;</li>
		<li>If you've never held a medical certificate, you will need to be issued an FAA medical certificate, regular or special issuance, from an AME one time only.</li>
		<li>If your regular or special-issuance medical certificate expired before July 15, 2006, you will need to get a medical certificate from an AME one time only.</li>
		<li>If you have a medical history or diagnosis of certain cardiac, neurological, or mental health conditions, you will need a one-time-only special issuance for each condition, <a href="##-Page G Tab 1" alt="BasicMed common disqualifications">learn more</a>.</li>
		<li>Your FAA Medical must not have been withdrawn, denied, revoked, or suspended for any reason.</li>
	</ul>
	<p>If your most recent medical certificate has been suspended at any point in time or revoked, withdrawn, suspended   if your most recent authorization for special issuance was withdrawn, or your most recent medical application was denied, revoked, withdrawn or suspended, you will need to obtain a new medical certificate before you can operate under BasicMed. <a href="##-Page G Tab 1" alt="BasicMed common disqualifications">Learn more about common disqualifications</a> and how you may be able to fly under BasicMed in the future.</p>
	<p>Whether you're new to the program, or if you're ready to renew or requalify for your medical certificate, AOPA is here to help you. Join the 80,000 pilots who have qualified to fly safely under the program since 2017. </p>
</div>

<!--END: Lower Page featured copy -->
<!--Page Bottom Have Questions section-->
<div class="haveQuestions" ng-include="::vm.url.template('common/_page-bottom-have-questions.html')"></div>
    </div>
    <!-- Content Panel 2 side rail -->
      <div class="contentPanel2" ng-include="::vm.url.template('common/_page-right-panel-quick-links.html')"></div>
  </div>
</div>

<div id="ntfy1" class="overlay">
  <div class="popup">
    <a class="close" href="javascript:void(0)" onclick='$("#ntfy1").hidePopup()'
      >&times;</a
    >
    <div class="content">
      <p>
        An account will keep your course progress and allow you to log in later
        or from another device to complete or review the materials.
      </p>
    </div>
  </div>
</div>
<script>
  document.getElementById('renewalForm').addEventListener('submit', function(event) {
    event.preventDefault();

    // Parse the input dates as local dates
    var medicalDate = new Date(document.getElementById("bmeddatepicker").value + "T00:00:00");
    var courseDate = new Date(document.getElementById("coursedatepicker").value + "T00:00:00");

    console.log('Entered Medical Date:', medicalDate);
    console.log('Entered Course Date:', courseDate);

    var renewalType = 'NEW';

    if (isValidDate(medicalDate) && isValidDate(courseDate)) {
        var medicalDeadline = getEndOfMonthPlusMonths(medicalDate, 48); // Adjusting for 48-month deadline
        var courseDeadline = getEndOfMonthPlusMonths(courseDate, 24); // Adjusting for 24-month deadline

        console.log('Calculated Medical Deadline:', medicalDeadline);
        console.log('Calculated Course Deadline:', courseDeadline);

        var now = new Date();
        console.log('Current Date (Now):', now);

        var medicalExpired = now > medicalDeadline;
        var courseExpired = now > courseDeadline;

        console.log('Medical expired?', medicalExpired);
        console.log('Course expired?', courseExpired);

        if (medicalExpired) {
            renewalType = 'MONTH48';
        } else if (courseExpired) {
            renewalType = 'MONTH24';
        } else {
            renewalType = 'NEW';
        }

        showModal(renewalType, medicalDate, courseDate, medicalExpired, courseExpired);
    }
  });
  
  function isValidDate(d) {
    return d instanceof Date && !isNaN(d);
  }
  
  // Adjusted logic to ensure the date is set to the end of the month correctly
  function getEndOfMonthPlusMonths(date, monthsToAdd) {
    let exp = new Date(date);
    exp.setMonth(exp.getMonth() + monthsToAdd);  // Add the months to the current month
    
    // Set the date to the last day of the new month
    exp.setMonth(exp.getMonth() + 1, 0);  // Set the date to the last day of the new month
    
    // Set the time to the last moment of the day (23:59:59.999)
    exp.setHours(23, 59, 59, 999);
    
    return exp;
  }
  
  function monthsBetween(start, end) {
    let years = end.getFullYear() - start.getFullYear();
    let months = end.getMonth() - start.getMonth();
    if (end.getDate() < start.getDate()) months--;
    return years * 12 + months;
  }
  
  function formatDate(date) {
    if (!date) return '';
    var month = (date.getMonth() + 1).toString().padStart(2, '0');
    var day = date.getDate().toString().padStart(2, '0');
    var year = date.getFullYear();
    return `${month}/${day}/${year}`;
  }
  
  function formatRange(startDate, endDate) {
    return `: ${startDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} - ${endDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`;
  }
  
  function getMonthDurationText(fromDate, toDate, isExpired) {
    let years = toDate.getFullYear() - fromDate.getFullYear();
    let months = toDate.getMonth() - fromDate.getMonth();
    if (toDate.getDate() < fromDate.getDate()) months--;
    if (months < 0) {
      years--;
      months += 12;
    }
    let totalMonths = years * 12 + months;
    let color = isExpired ? 'red' : 'green';
    return `<strong style="color:${color};">${totalMonths} months</strong>`;
  }
  
  function getRenewalTitle(renewalType) {
    if (renewalType === 'NEW') return 'New to BasicMed';
    if (renewalType === 'MONTH24') return '24-Month Renewal Steps';
    if (renewalType === 'MONTH48') return '48-Month Renewal Steps';
  }
  
  function showModal(renewalType, medicalDate, courseDate, medicalExpired, courseExpired) {
    var modal = document.getElementById("stepsModal");
    var stepsContainer = document.getElementById("renewalSteps");
    stepsContainer.innerHTML = '';
  
    var now = new Date();
    var medicalDateStr = formatDate(medicalDate);
    var courseDateStr = formatDate(courseDate);
  
    var medicalDuration = getMonthDurationText(medicalDate, now, medicalExpired);
    var courseDuration = getMonthDurationText(courseDate, now, courseExpired);
  
    var alertMessage = (medicalExpired || courseExpired)
      ? `<div class="alert-message">
          <strong style="color: red;">IMPORTANT:</strong> It looks like you may have exceeded the required renewal timeline per the FAA BasicMed regulation.<br><br>
          There is no penalty if you are not flying, this lapse is not reported to the FAA, and you can easily regain your BasicMed privileges. Just follow the easy steps to complete your renewal process.
        </div>` : '';
  
    var dateInfo = `
      <h4 style="text-align: center; margin-bottom: 10px; font-size:2em;">${getRenewalTitle(renewalType)}</h4>
      <p style="text-align: center; font-size: 1em;">
        <strong>Your last BasicMed Exam was on:</strong> ${medicalDateStr}<br>
        ${medicalDuration} ${formatRange(medicalDate, now)}<br><br>
        <strong>Your last BasicMed Course completion was on:</strong> ${courseDateStr}<br>
        ${courseDuration} ${formatRange(courseDate, now)}
      </p>
      <hr/>
      ${alertMessage}
    `;
  
    let steps = '';
  
    if (renewalType === 'NEW') {
      steps = `
      <div class="l-wrapper tcMedProcess">
        <div class="tcMonthRenewal">
          <div class="step step1">
            <div class="icon">
              <img style="height: 80%" alt="clipboard icon" src="themes/aopa/images/AOPA_brand_icons_Download_forms_PMS303.png">
            </div>
            <h4>Step 1: Get the BasicMed FAA CMEC Form</h4>
            <p>Review if you're eligible for BasicMed and download the 
              <a href="https://www.faa.gov/documentLibrary/media/Form/FAA_Form_8700-2_OMB_EXP_06-2026.pdf" target="_blank">BasicMed FAA Comprehensive Medical Examination Checklist (CMEC)</a>.
              Complete the self-assessment portion of the form.</p>
          </div>
          <div class="step step2">
            <div class="icon">
              <img style="height: 80%" alt="doctor icon" src="themes/aopa/images/AOPA_brand_icons_Doctor_PMS303.png">
            </div>
            <h4>Step 2: See Your Doctor</h4>
            <p>Take your Comprehensive Medical Examination Checklist (from Step 1) and get a BasicMed specific exam by a state-licensed doctor. Have your doctor fill out the rest of the exam checklist. You will need this to complete step 3 and will need it again for your 24-month renewal.</p>
          </div>
          <div class="step step3">
            <div class="icon">
              <img style="height: 80%" alt="certificate icon" src="themes/aopa/images/AOPA_brand_icons_Online course_PMS303.png">
            </div>
            <h4>Step 3: Take Online Course</h4>
            <p>Once you have completed your FAA CMEC from a state licensed physician, take this online course and pass the quiz. You <strong>must complete the post-course form</strong> to submit your exam information (from Step 2) to the FAA to earn your BasicMed completion certificate.</p>
          </div>
          <div class="step step4">
            <div class="icon">
              <img style="height: 80%" alt="aeroplane icon" src="themes/aopa/images/AOPA_brand_icons_File docs_PMS303.png">
            </div>
            <h4>Step 4: File Documents in Your Logbook</h4>
            <p>Download your course completion certificate and keep it with your completed CMEC in your logbook or electronically. You need to have it available upon request from the FAA. Make sure you have a valid flight review, and you are ready to fly!</p>
          </div>
        </div>
      </div>`;
    } else if (renewalType === 'MONTH24') {
      steps = `
      <div class="l-wrapper tcMedProcess">
        <div class="tcMonthRenewal">
          <div class="step step1">
            <div class="icon">
              <img style="height: 80%" alt="doctor icon" src="themes/aopa/images/AOPA_brand_icons_Renewal_docs_in_hand_PMS303.png">
            </div>
            <h4>Step 1: Get Out Your Most Recent CMEC</h4>
            <p>With this renewal, you will need your most recent FAA Comprehensive Medical Examination Checklist (CMEC). This will most likely be from your previous BasicMed exam 24 months ago. You will submit the exam information electronically again via post-course form to the FAA for your renewal.</p>
          </div>
          <div class="step step2">
            <div class="icon">
              <img style="height: 80%" alt="certificate icon" src="themes/aopa/images/AOPA_brand_icons_Online course_PMS303.png">
            </div>
            <h4>Step 2: Take Online Course</h4>
            <p>Complete the BasicMed online course and pass the quiz. Then, fill out the online form at the end of the course with your FAA pilot information and the physician’s information from the completed CMEC. Finally, <strong>submit the online form</strong> and print your course completion certificate.</p>
          </div>
          <div class="step step3">
            <div class="icon">
              <img style="height: 80%" alt="aeroplane icon" src="themes/aopa/images/AOPA_brand_icons_File docs_PMS303.png">
            </div>
            <h4>Step 3: File Documents in Your Logbook</h4>
            <p>Download your course completion certificate and keep it with your completed CMEC in your logbook or electronically. You need to have it available upon request from FAA. Make sure you have a valid flight review, and you're ready to fly!</p>
          </div>
        </div>
      </div>`;
    } else if (renewalType === 'MONTH48') {
      steps = `
      <div class="l-wrapper tcMedProcess">
        <div class="tcMonthRenewal">
          <div class="step step1">
            <div class="icon">
              <img style="height: 80%" alt="clipboard icon" src="themes/aopa/images/AOPA_brand_icons_Download_forms_PMS303.png">
            </div>
            <h4>Step 1: Get the BasicMed FAA CMEC Form</h4>
            <p>This is just like applying to BasicMed for the first time. Reset your renewal clock by getting a new <a href="https://www.faa.gov/documentLibrary/media/Form/FAA_Form_8700-2_OMB_EXP_06-2026.pdf" target="_blank">Comprehensive Medical Examination Checklist</a> and completing the self-assessment portion.</p>
          </div>
          <div class="step step2">
            <div class="icon">
              <img style="height: 80%" alt="doctor icon" src="themes/aopa/images/AOPA_brand_icons_Doctor_PMS303.png">
            </div>
            <h4>Step 2: See Your Doctor</h4>
            <p>Take your Comprehensive Medical Examination Checklist (from Step 1) and get a BasicMed specific exam by a state-licensed physician. Have your doctor fill out the rest of the exam checklist.</p>
          </div>
          <div class="step step3">
            <div class="icon">
              <img style="height: 80%" alt="certificate icon" src="themes/aopa/images/AOPA_brand_icons_Online course_PMS303.png">
            </div>
            <h4>Step 3: Take Online Course</h4>
            <p>Once you have completed your FAA CMEC from a state-licensed physician, take this online course and pass the quiz. Submit your exam information via post-course online form to the FAA to earn your BasicMed completion certificate.</p>
          </div>
          <div class="step step4">
            <div class="icon">
              <img style="height: 80%" alt="aeroplane icon" src="themes/aopa/images/AOPA_brand_icons_File docs_PMS303.png">
            </div>
            <h4>Step 4: File Documents in Your Logbook</h4>
            <p>Download your course completion certificate and keep it with your completed CMEC in your logbook or electronically. Make sure you have a valid flight review, and you're ready to fly!</p>
          </div>
        </div>
      </div>`;
    }
  
    stepsContainer.innerHTML = dateInfo + steps;
  
    modal.style.display = "block";
  
    modal.addEventListener('click', function(event) {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
  
    document.querySelector('.close-btn').addEventListener('click', function () {
      modal.style.display = "none";
    });
  }
</script>


