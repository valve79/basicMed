<div ng-controller="courses.CourseEditController as vm"><ul class="nav nav-pills"><li role="presentation" ng-class="{'active': vm.isTopMenuActive('info')}"><a role="button" ng-click="vm.setTopMenu('info')" href="javascript:void(0)">About</a></li><li role="presentation" ng-class="{'active': vm.isTopMenuActive('course')}" ng-if="vm.courseId"><a role="button" ng-click="vm.setTopMenu('course')" href="javascript:void(0)">Course</a></li><li ng-if="::vm.courseId" role="presentation" ng-class="{'active': vm.isTopMenuActive('LandingPage')}"><a role="button" ng-click="vm.setTopMenu('LandingPage'); vm.loadLandingPage();" href="javascript:void(0)">Welcome page</a></li><li ng-if="::vm.courseId" role="presentation" ng-class="{'active': vm.isTopMenuActive('BundleForm')}"><a role="button" ng-click="vm.setTopMenu('BundleForm'); vm.loadBundleForm();" href="javascript:void(0)">Attached files</a></li><li ng-if="::vm.courseId" class="pull-right"><a role="button" ng-click="vm.editCourse()">Back to view course</a></li></ul><div ng-cloak ng-if="vm.isTopMenuActive('info')"><div class="col-lg-12 col-xs-12"><i class="vhs-purple-text">* Required fields</i></div><form class="form-horizontal" ng-submit="vm.save()" id="course_form" name="course_form"><div class="col-lg-6 col-sm-6 col-xs-12"><div class="form-group"><div class="col-lg-4 col-xs-4 control-label"><label class="vhs-required">Subject</label></div><div class="col-sm-8 col-xs-8 pull-right"><div reference-dropdown-selector vhs-reference-name="'subjects'" vhs-model="vm.course" vhs-model-property="'subjectId'" vhs-element-name="subjectField" vhs-nullable="false" vhs-required="true" vhs-editable="true"/><span class="error" ng-show="course_form.subjectField.$error.required">Please specify a subject</span></div></div><div class="form-group"><label class="col-sm-4 col-xs-4 control-label vhs-required">Name</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="topicField" name="topicField" ng-model="vm.course.topic" maxlength="255" required> <span class="error" ng-show="course_form.topicField.$error.required">Please specify a course name</span></div></div><div class="form-group"><label class="col-sm-4 col-xs-4 control-label">Author</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="authorField" name="authorField" ng-model="vm.course.author" maxlength="255"></div></div><div class="form-group"><div class="col-lg-4 col-xs-4 control-label"><label class="vhs-required">Type</label></div><div class="col-sm-8 col-xs-8 pull-right"><div reference-dropdown-selector vhs-reference-name="'courseTypes'" vhs-model="vm.course" vhs-model-property="'typeId'" vhs-element-name="typeField" vhs-nullable="false" vhs-required="true" vhs-editable="false"/><span class="error" ng-show="course_form.typeField.$error.required">Please specify a type</span></div></div><div class="form-group"><div class="col-lg-4 col-xs-4 control-label"><label class="vhs-required">Source</label></div><div class="col-sm-8 col-xs-8 pull-right"><div reference-dropdown-selector vhs-reference-name="'sources'" vhs-model="vm.course" vhs-model-property="'sourceId'" vhs-element-name="sourceField" vhs-nullable="false" vhs-required="true" vhs-editable="true"/><span class="error" ng-show="course_form.sourceField.$error.required">Please specify a source</span></div></div><div class="form-group"><label class="col-sm-4 col-xs-4 control-label">Thumbnail</label><div class="col-sm-8 col-xs-8 pull-right"><div ng-if="vm.preview || vm.previewUrl"><div class="hover-btn"><button type="button" class="close" data-dismiss="alert" title="Удалить" ng-click="vm.resetPreview()"><span aria-hidden="true">×</span> <span class="sr-only">Удалить</span></button></div><img class="img-preview" ngf-src="vm.preview" ngf-background="vm.preview"> <img class="img-preview" ngf-src="vm.previewUrl" ngf-background="vm.previewUrl" ng-if="vm.courseId && !vm.preview"></div><div class="input-group"><span class="fileUpload btn btn-block vhs-green vhs-white-text" ng-disabled="vm.disabledUploadButton" ng-if="!vm.preview && !vm.previewUrl"><span>Upload</span> <input type="file" class="upload" ngf-select ng-model="vm.preview" ngf-pattern=".jpg,.png,.bmp" id="uploadPreviewField" name="uploadPreviewField"/></span></div><button class="btn btn-default" type="button" ng-click="vm.restorePreviewUrl()" ng-if="vm.hasPreviewUrlCanceled">Отменить</button> <span class="error" ng-show="course_form.uploadPreviewField.$error.pattern">Invalid file format: please select a file with .jpg, .png, or .bmp extension</span></div></div><div class="form-group"><div class="checkbox col-xs-offset-4 col-xs-8"><label><input type="checkbox" ng-model="vm.hasCertificates"> Issue a certificate upon successful completion</label></div></div><div class="form-group" ng-if="vm.hasCertificates"><label class="col-sm-4 col-xs-4 control-label">Certificate(s)</label><div class="col-sm-8 col-xs-8 pull-right"><div ng-repeat="courseCertificate in vm.courseCertificates"><div ng-if="!courseCertificate.removed"><div class="input-group"><input type="text" class="form-control" ng-model="courseCertificate.name" disabled="disabled"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="courseCertificate.removed = true"><span>Remove</span></button></span></div></div></div><div ng-repeat="certificate in vm.uploadCourseCertificates"><div class="input-group"><input type="text" class="form-control" ng-model="certificate.name" disabled="disabled"> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="vm.removeCertificate($index)"><span>Remove</span></button></span></div></div><div class="input-group"><div class="fileUpload btn btn-block vhs-green vhs-white-text" ng-disabled="vm.disabledUploadButton"><span>Upload</span> <input type="file" class="upload" ngf-select="vm.attachCertificate($file.$error)" ng-model="vm.newCertificate" ngf-pattern=".jasper" id="uploadCertificateField" name="uploadCertificateField"/></div></div><span>{{vm.newCertificate.name}}</span> <span class="error" ng-show="course_form.uploadCertificateField.$error.pattern">Invalid file format: please select a file with .jasper extension</span></div></div><div class="form-group"><label class="col-lg-4 col-sm-5 col-xs-4 control-label">Price</label><div class="col-lg-8 col-sm-7 col-xs-8 pull-right"><input type="number" step="0.01" class="form-control" id="priceField" name="priceField" ng-model="vm.course.price" min="0" max="9007199254740992"> <span class="error" ng-show="course_form.priceField.$error.number">Please enter a number </span><span class="error" ng-show="course_form.priceField.$error.min">Please enter a non-negative number </span><span class="error" ng-show="course_form.priceField.$error.max">This number is too big</span></div></div></div><div class="col-lg-6 col-sm-6 col-xs-12"><div class="form-group"><label class="col-sm-4 col-xs-4 control-label vhs-required">Language</label><div class="col-sm-8 col-xs-8"><div reference-dropdown-selector vhs-reference-name="'languages'" vhs-model="vm.course" vhs-model-property="'languageId'" vhs-element-name="languageField" vhs-nullable="true" vhs-required="true" vhs-editable="true" vhs-on-change="vm.materialLanguageChangeCallback(name)"/><span class="error" ng-show="course_form.languageField.$error.required">Please specify a language of the course</span></div></div><div class="form-group"><div class="col-lg-4 col-xs-4 control-label"><label class="vhs-required">Level of complexity</label></div><div class="col-sm-8 col-xs-8 pull-right"><div reference-dropdown-selector vhs-reference-name="'complexityLevels'" vhs-model="vm.course" vhs-model-property="'complexityLevelId'" vhs-element-name="complexityLevelField" vhs-nullable="false" vhs-required="true"/><span class="error" ng-show="course_form.complexityLevelField.$error.required">Please specify a level of complexity</span></div></div><div class="form-group"><div class="col-lg-4 col-xs-4 control-label"><label class="vhs-required">Start date</label></div><div class="col-sm-8 col-xs-8 pull-right"><input date-picker type="text" size="10" style="margin-left: 5px;" class="form-control pull-right" ng-model="vm.course.startDateText" id="startDateField" name="startDateField" ng-pattern="/^(0?[1-9]|1[012])\/(0?[1-9]|[12][0-9]|3[01])\/((18|19|20)\d{2})$/" ng-required="true"/> <span class="error" ng-show="course_form.startDateField.$error.required">Please specify a start date</span> <span class="error" ng-show="course_form.startDateField.$error.pattern">Invalid date format</span></div></div><div class="form-group"><label class="col-sm-4 col-xs-4 control-label">Expiration</label><div class="col-sm-8 col-xs-8 form-inline pull-right"><div class="radio-inline col-lg-1 col-sm-12"><label class="control-label" style="font-weight:500"><input type="radio" ng-value="true" ng-model="vm.isValidityInPerpetuity" ng-click="vm.cleanValidity()"> Never expires</label></div><div class="radio-inline form-inline pull-right"><label class="control-label" style="font-weight:500"><input type="radio" ng-value="false" ng-model="vm.isValidityInPerpetuity"> To</label> <input date-picker ng-disabled="vm.isValidityInPerpetuity" type="text" size="10" style="margin-left: 5px;" class="form-control pull-right" ng-model="vm.course.endDateText" id="validityInPerpetuityFieldId" name="validityInPerpetuityField" ng-pattern="/^(0?[1-9]|1[012])\/(0?[1-9]|[12][0-9]|3[01])\/((18|19|20)\d{2})$/"/></div></div><span class="error" ng-show="course_form.validityInPerpetuityField.$error.pattern">Invalid date format</span></div><div class="form-group"><label class="col-lg-4 col-sm-5 col-xs-4 control-label vhs-required">Responsible teachers</label><div class="col-lg-8 col-sm-7 col-xs-8 pull-right"><select class="form-control" id="ownersField" name="ownersField" ng-model="vm.course.ownerIds" ng-required="true" ng-options="::w.id as ::w.name for w in ::vm.owners" multiple="multiple"></select> <span class="error" ng-show="course_form.ownersField.$error.required">Please specify a course responsible teachers</span></div></div></div><div class="col-lg-12 col-xs-12"><div class="form-group"><label class="col-sm-2 col-xs-4 control-label">Summary</label><div class="col-sm-10 col-xs-8 pull-right"><div vhs-rich-text-editor vhs-embed-materials="true" vhs-embed-bundles="true" vhs-embed-sandbox="true" vhs-bundle-id="{{::vm.course.bundleId}}"><div text-angular id="descriptionField" name="descriptionField" ta-max-text="2000" ng-model="vm.course.summary"></div></div></div><span class="error" ng-show="course_form.descriptionField.$error.taMaxText">Maximum number of characters exceeded</span></div></div><div class="col-lg-12"><div class="form-group" ng-if="vm.permissionsWithUsersAndGroups.length > 0"><div users-and-groups-selector vhs-object-model="vm" vhs-object-model-property="'course'" vhs-current-user-id-model="vm" vhs-current-user-id-model-property="'currentUserId'" vhs-current-user-name-model="vm" vhs-current-user-name-model-property="'currentUserName'" vhs-permissions-with-users-and-groups-model="vm.permissionsWithUsersAndGroups"></div></div></div><div class="row" ng-if="!vm.courseId"><div class="col-sm-offset-5 col-sm-2 col-xs-offset-5 col-xs-3 text-center"><button class="btn btn-block vhs-green vhs-white-text" type="submit" ng-disabled="vm.disabledSaveButton">Next</button></div></div><div class="row" ng-if="vm.courseId"><div class="col-sm-offset-4 col-sm-2 col-xs-offset-5 col-xs-3 text-center"><button class="btn btn-block vhs-green vhs-white-text" type="submit" ng-disabled="vm.disabledSaveButton">Save</button></div><div class="col-sm-2 col-xs-3 text-center"><button class="btn btn-block vhs-brown vhs-white-text" type="button" ng-click="vm.redirect()">Cancel</button></div></div></form></div><form ng-cloak id="landingPageForm" name="landingPageForm"><div ng-if="vm.isTopMenuActive('LandingPage')"><div class="row"><div class="col-xs-8" vhs-rich-text-editor vhs-embed-materials="true" vhs-embed-bundles="true" vhs-bundle-id="{{::vm.course.bundleId}}"><div text-angular ng-model="vm.landingPage.richText"></div></div></div><div class="row"><div class="row"><br></div><div class="col-sm-offset-1 col-sm-2 col-xs-offset-0 col-xs-3 text-center"><button class="btn btn-block vhs-green vhs-white-text" type="button" ng-click="vm.saveLandingPage()">Save</button></div><div class="col-sm-2 col-xs-3 text-center"><button class="btn btn-block vhs-brown vhs-white-text" type="button" ng-click="vm.loadLandingPage()">Cancel</button></div></div></div></form><div ng-cloak ng-if="vm.isTopMenuActive('course')" class="row"><div class="col-sm-12"><div class="col-sm-3"><div class="pull-left"><a ng-href="" ng-click="vm.showCreationModal(vm.MODULE, null)">+Add module</a></div></div></div><div class="col-sm-3"><div class="broadcast-container"><div id="leftCourseMenu" dnd-list="vm.modules" dnd-allowed-types="['module']" dnd-inserted="vm.saveModulesHierarchy(index, item)"><div ng-repeat="module in vm.modules" class="list-group panel course-module" dnd-draggable="module" draggable="{{!module.editing}}" dnd-effect-allowed="move" dnd-type="'module'" dnd-moved="vm.modules.splice($index, 1)"><div class="list-group-item clearfix" data-toggle="collapse" data-target="#module{{::module.id}}" aria-expanded="true" ng-click="vm.setLeftMenuModule(module.id)"><button type="button" class="close hover-btn pull-left" data-dismiss="alert" title="Remove module" ng-click="vm.showRemovalModal(vm.MODULE, module, null); $event.stopPropagation()"><span aria-hidden="true">×</span> <span class="sr-only">Remove module</span></button> <span ng-if="!vm.isModuleEditing || (vm.isModuleEditing && vm.editingModule.id != module.id)">{{module.name}}</span> <span ng-if="vm.isModuleEditing && vm.editingModule.id == module.id"><input type="text" ng-model="vm.editingModule.name" maxlength="255" ng-click="$event.stopPropagation()"> </span><button ng-if="!vm.isModuleEditing || (vm.isModuleEditing && vm.editingModule.id != module.id)" class="btn-link pull-right" data-toggle="tooltip" title="Add section" ng-click="vm.showCreationModal(vm.SECTION, module.id); $event.stopPropagation()"><span aria-hidden="true" class="glyphicon glyphicon-plus"></span></button> <button ng-if="!vm.isModuleEditing || (vm.isModuleEditing && vm.editingModule.id != module.id)" type="button" class="close hover-btn btn-sm pull-right" data-dismiss="alert" title="Edit" ng-click="vm.startModuleInlineEdit(module); $event.stopPropagation(); module.editing=true"><span aria-hidden="true" class="btn-edit-name"><i class="fa fa-pencil"></i></span> <span class="sr-only">Edit</span></button> <button ng-if="vm.isModuleEditing && vm.editingModule.id == module.id" type="button" class="close hover-btn btn-sm pull-right" data-dismiss="alert" title="Apply" ng-click="vm.updateEditedModule(module); $event.stopPropagation(); module.editing=false"><span aria-hidden="true" class="btn-edit-name glyphicon glyphicon-ok"></span> <span class="sr-only">Apply</span></button></div><div class="collapse in" id="module{{::module.id}}" dnd-list="vm.sectionsMap.get(module.id)" dnd-allowed-types="['section']" dnd-inserted="vm.saveSectionsHierarchy(index, item, module.id)"><div ng-repeat="sectionEntry in vm.sectionsMap.get(module.id)" dnd-draggable="sectionEntry" draggable="{{!module.editing}}" dnd-effect-allowed="move" dnd-type="'section'" dnd-moved="vm.sectionsMap.get(module.id).splice($index, 1)"><div ng-click="vm.saveSection(sectionEntry.section)" ng-show="sectionEntry.visible" ng-class="{'active': vm.isLeftMenuItemActive(vm.menuKey.topMenu, module.id, sectionEntry.section.id)}" class="list-group-item list-group-item-child"><button type="button" class="close hover-btn pull-left" data-dismiss="alert" title="Remove section" ng-click="vm.showRemovalModal(vm.SECTION, null, sectionEntry.section); $event.stopPropagation()"><span aria-hidden="true">×</span> <span class="sr-only">Remove module</span></button><div class="lvl{{::(sectionEntry.level)}}"><span ng-if="::(sectionEntry.children.length > 0)"><span class="node-expanded" ng-show="sectionEntry.state === 'EXPANDED'" ng-click="sectionEntry.collapse(); $event.stopPropagation()"></span> <span class="node-collapsed" ng-show="sectionEntry.state === 'COLLAPSED'" ng-click="sectionEntry.expand(); $event.stopPropagation()"></span> </span><button ng-if="!vm.isSectionEditing || (vm.isSectionEditing && vm.editingSection.id != sectionEntry.section.id)" type="button" class="close hover-btn btn-sm pull-right label-thumbs" data-dismiss="alert" title="Edit" ng-click="vm.showEditingModal(sectionEntry.section); $event.stopPropagation()"><span aria-hidden="true" class="btn-edit-name"><i class="fa fa-wrench"></i></span> <span class="sr-only">Edit</span></button> <button ng-if="!vm.isSectionEditing || (vm.isSectionEditing && vm.editingSection.id != sectionEntry.section.id)" type="button" class="close hover-btn btn-sm pull-right" data-dismiss="alert" title="Edit" ng-click="vm.startSectionInlineEdit(sectionEntry.section); $event.stopPropagation(); module.editing=true"><span aria-hidden="true" class="btn-edit-name"><i class="fa fa-pencil"></i></span> <span class="sr-only">Edit</span></button> <button ng-if="vm.isSectionEditing && vm.editingSection.id == sectionEntry.section.id" type="button" class="close hover-btn btn-sm pull-right" data-dismiss="alert" title="Apply" ng-click="vm.updateEditedSection(); $event.stopPropagation(); module.editing=false"><span aria-hidden="true" class="btn-edit-name glyphicon glyphicon-ok"></span> <span class="sr-only">Apply</span></button> <span ng-if="!vm.isSectionEditing || (vm.isSectionEditing && vm.editingSection.id != sectionEntry.section.id)">{{sectionEntry.section.name}} </span><span ng-if="vm.isSectionEditing && vm.editingSection.id == sectionEntry.section.id" ng-class="{'simple-text-color': vm.selectedSection.id == sectionEntry.section.id}"><input type="text" ng-model="vm.editingSection.name" maxlength="255" class="course-section-edit" ng-click="$event.stopPropagation()"></span></div></div></div></div></div></div></div><div ng-if="vm.modules.length == 0">Modules not found</div></div><div class="col-sm-9" ng-if="vm.isSelectedSectionTypeInfo()"><div class="form-horizontal" id="sectionTypeInfo" name="vm.sectionTypeInfo"><div class="form-group"><div class="col-lg-6 form-group"><div class="col-sm-6"><button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseform" aria-expanded="false" aria-controls="collapseExample">Add a material <span class="caret"></span></button></div><div class="col-sm-6" ng-if="vm.systemPermissions.addMaterial"><button class="btn btn-block vhs-green vhs-white-text" ng-click="vm.toggleMaterialCreationForm()">Upload <span class="caret"></span></button></div></div></div><div class="form-group col-lg-6"><div class="collapse" id="collapseform" vhs-grid data-grid-model-path="vm.uploadMaterialsGridModel" data-vhs-grid-uuid="uploadMaterialsGrid" ng-if="vm.sectionMaterials"><div class="form-inline form-header material-form-header" data-vhs-auto-search><label for="searchField" class="label-search">The total number of records: {{vm.uploadMaterialsGridModel.totalCount}}</label> <span class="glyphicon glyphicon-search" aria-hidden="true" data-toggle="collapse" data-target="#searchField" aria-expanded="false" aria-controls="collapseExample"></span> <input type="text" class="form-control collapse" id="searchField" maxlength="500" placeholder="Search" ng-model="vm.uploadMaterialsGridModel.filter.searchString"/></div><div class="table-scroll"><table class="table table-hover table-striped" data-vhs-table><thead><tr><th>Title</th><th>Type</th><th></th></tr></thead><tbody><tr ng-repeat="material in vm.uploadMaterialsGridModel.entries"><td><a ng-show="::material.permissions.view" ng-href="#{{vm.materialsRouter.watchUrl(material.id)}}">{{::material.title}}</a> <span ng-hide="::material.permissions.view">{{::material.title}}</span></td><td>{{ ::material.typeName }}</td><td><div class="btn-group btn-group-xs"><a class="btn btn-primary" ng-click="vm.addMaterialToSection(material)">Add</a></div></td></tr><tr ng-if="vm.uploadMaterialsGridModel.entries.length == 0"><td colspan="3">Materials not found</td></tr></tbody></table></div><div vhs-grid-pagination></div></div></div><div class="form-group col-lg-6"><div id="materialCreationForm" ng-if="vm.showMaterialCreationForm"><div vhs-material-editing callback-when-finished="vm.callbackWhenMaterialCreated(material)" course="vm.course"></div></div></div><div class="form-group"><div class="col-lg-7 col-md-7 col-xs-7"><div ng-if="vm.isViewAllowed" ng-switch="vm.materialType"><div ng-if="vm.materialType == 'VIDEO' || vm.materialType == 'AUDIO'" vhs-thumbnail vhs-thumbnail-model="vm.material"></div><div ng-switch-when="VIDEO" vhs-video vhs-sources="vm.multimediaSources" vhs-width="'100%'" vhs-height="'300px'" vhs-poster="vm.material.previewUrl"></div><div ng-switch-when="YOUTUBE"><div vhs-youtube-video vhs-sources="vm.multimediaSources" vhs-width="'100%'" vhs-height="'300px'" vhs-poster="vm.material.previewUrl"></div></div><div ng-switch-when="AUDIO" vhs-audio vhs-sources="vm.multimediaSources" vhs-width="'100%'" vhs-height="'300px'" vhs-poster="vm.material.previewUrl"></div><div ng-switch-when="DOCUMENTS" class="material-download"><div align="center"><a ng-href="{{vm.material.downloadUrl}}" target="_blank"><img src="themes/default/img/download.png"> Download the file</a></div></div><div ng-switch-when="PHOTO" class="material-download"><img ng-src="{{vm.material.downloadUrl}}" width="100%" height="100%"></div><div ng-switch-when="LINK" class="material-download"><div align="center"><a ng-href="{{vm.material.link}}" target="_blank"><img src="themes/default/img/redirect.png"> Open the link</a></div></div></div><div class="form-signin" ng-if="vm.sectionMaterials.length == 0"><div class="alert alert-info" role="alert"><p><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> <strong>Materials in section not found.</strong></p></div></div><div class="form-signin" ng-if="vm.sectionMaterials.length != 0 && !vm.material.id"><div class="alert alert-info" role="alert"><p><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> <strong>Material for view not selected.</strong></p></div></div><div class="form-signin" ng-if="vm.sectionMaterials.length != 0 && vm.isMaterialNotReady"><div class="alert alert-warning" role="alert"><p><span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span> <strong>The material is currently being processed</strong></p><p>To view or download it, please visit this page after a while</p></div></div><div class="form-signin" ng-if="vm.sectionMaterials.length != 0 && vm.isMaterialEmpty"><div class="alert alert-warning" role="alert"><p><span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span> <strong>Content of the material has not been uploaded yet</strong></p><p>To view or download this material, please visit this page later</p></div></div></div><div class="col-lg-5"><table class="table"><thead></thead><tbody><tr ng-repeat="material in vm.sectionMaterials" ng-click="vm.showMaterial(material)" ng-class="{'selected-table-row': vm.selectedMaterialId == material.id}"><td><a ng-if="material.permissions.view" href="javascript:void(0)">{{::material.title}}</a> <span ng-if="!material.permissions.view">{{::material.title}}</span></td><td><span class="{{::vm.getMaterialTypeClass(material.typeKey)}}"></span></td><td ng-click="$event.stopPropagation()"><button class="btn btn-link" type="button" title="Up" ng-click="vm.moveUp($index)" ng-disabled="!vm.isMoveUp($index)"><span class="glyphicon glyphicon-arrow-up"></span></button> <button class="btn btn-link" type="button" title="Down" ng-click="vm.moveDown($index)" ng-disabled="!vm.isMoveDown($index)"><span class="glyphicon glyphicon-arrow-down"></span></button> <button class="btn btn-default btn-sm" type="button" ng-click="vm.removeMaterialFromSection($index, material)"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>Remove</button></td></tr></tbody></table></div></div><div class="form-group col-lg-12" vhs-rich-text-editor vhs-embed-materials="true" vhs-embed-bundles="true" vhs-embed-sandbox="true" vhs-bundle-id="{{::vm.course.bundleId}}"><div text-angular ta-max-text="20000" ng-model="vm.selectedSection.summary" ng-change="vm.setFormIsDirty()"></div></div></div><div class="row"><div class="col-sm-offset-4 col-sm-2 col-xs-offset-5 col-xs-3 text-center"><button class="btn btn-block vhs-green vhs-white-text" type="button" ng-click="vm.saveSection(vm.selectedSection)">Save</button></div><div class="col-sm-2 col-xs-3 text-center"><button class="btn btn-block vhs-brown vhs-white-text" type="button" ng-click="vm.reloadSection(vm.selectedSection)">Cancel</button></div></div></div><div class="col-sm-9" ng-if="vm.isSelectedSectionTypeQuiz()"><div class="form-horizontal" id="sectionTypeQuiz"><div class="form-group"><div class="col-lg-6"><button class="col-lg-6 btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseQuizForm" aria-expanded="false" aria-controls="collapseExample">Add a quiz <span class="caret"></span></button></div></div><div class="form-group"><div class="collapse col-lg-6" id="collapseQuizForm" vhs-grid data-grid-model-path="vm.availableQuizzesGridModel" data-vhs-grid-uuid="availableQuizzesGridModel"><div class="form-inline form-header material-form-header" data-vhs-auto-search><label for="searchQuizField" class="label-search">The total number of records: {{vm.availableQuizzesGridModel.totalCount}}</label> <span class="glyphicon glyphicon-search" aria-hidden="true" data-toggle="collapse" data-target="#searchQuizField" aria-expanded="false" aria-controls="collapseExample"></span> <input type="text" class="form-control collapse" id="searchQuizField" maxlength="500" placeholder="Search" ng-model="vm.availableQuizzesGridModel.filter.searchString"/></div><div class="table-scroll"><table class="table table-hover table-striped" data-vhs-table><thead><tr><th>Title</th><th>Subject</th><th></th></tr></thead><tbody><tr ng-repeat="quiz in vm.availableQuizzesGridModel.entries"><td>{{::quiz.title}}</td><td>{{ ::quiz.subjectName }}</td><td><div class="btn-group btn-group-xs"><button class="btn btn-primary" ng-click="vm.addQuizToSection(quiz)">Add</button></div></td></tr><tr ng-if="vm.availableQuizzesGridModel.entries.length == 0"><td colspan="3">Quizzes not found</td></tr></tbody></table></div><div vhs-grid-pagination></div></div></div><div class="form-group"><div class="checkbox"><label><input type="checkbox" value="" ng-model="vm.selectedSection.allowResit" ng-change="vm.setFormIsDirty()"> Allow resit</label></div><div class="checkbox"><label><input type="checkbox" value="" ng-model="vm.selectedSection.blockingNextSections" ng-change="vm.setFormIsDirty()"> Block access to the next sections</label> <span class="glyphicon glyphicon-question-sign vhs-green-text" aria-hidden="true" data-toggle="collapse" data-target="#infoField" aria-expanded="false" aria-controls="collapseExample"></span> <span id="infoField" class="collapse vhs-orange-text"><p>Block access to the next sections of the course until this quiz is passed</p></span></div><div class="checkbox"><label><input type="checkbox" value="" ng-model="vm.selectedSection.lockUntilPreviousSectionsRead" ng-change="vm.setFormIsDirty()"> Block access to the quiz until previous sections viewed</label></div></div><div class="broadcast-container form-group" ng-if="vm.sectionQuiz.id"><div class="col-lg-4"><h6><strong>Subject:</strong> <span ng-bind="vm.sectionQuiz.subjectName"></span></h6><h6><strong>Title:</strong> <span ng-bind="vm.sectionQuiz.title"></span></h6><h6><strong>Language:</strong> <span ng-bind="vm.sectionQuiz.languageName"></span></h6></div><div class="col-lg-4"><h6><strong>Owner:</strong> <span ng-bind="vm.sectionQuiz.ownerName"></span></h6><h6><strong>Duration:</strong> <span ng-if="vm.sectionQuiz.duration" class="form-control-static">{{vm.sectionQuiz.duration | numeraljs:'00:00:00'}}</span> <span ng-if="!vm.sectionQuiz.duration" class="form-control-static">not limited</span></h6><h6><strong>Additional information:</strong> <span ng-bind="vm.sectionQuiz.summary"></span></h6></div><div class="col-lg-4"><button class="btn btn-default btn-sm text-center" type="button" ng-click="vm.removeQuizFromSection()"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>Remove</button></div></div><div class="form-group col-lg-12" vhs-rich-text-editor vhs-embed-materials="true" vhs-embed-bundles="true" vhs-embed-sandbox="true" vhs-bundle-id="{{::vm.course.bundleId}}"><div text-angular ta-max-text="20000" ng-model="vm.selectedSection.summary" ng-change="vm.setFormIsDirty()"></div></div></div><div class="row"><div class="col-sm-offset-4 col-sm-2 col-xs-offset-5 col-xs-3 text-center"><button class="btn btn-block vhs-green vhs-white-text" type="button" ng-click="vm.saveSection(vm.selectedSection)">Save</button></div><div class="col-sm-2 col-xs-3 text-center"><button class="btn btn-block vhs-brown vhs-white-text" type="button" ng-click="vm.reloadSection(vm.selectedSection)">Cancel</button></div></div></div><div class="col-sm-9" ng-if="vm.isSelectedSectionTypeProblemSolution()"></div></div><div ng-cloak ng-if="vm.isTopMenuActive('BundleForm')"><div ng-hide="vm.archiveUploading"><div class="col-lg-12"><div class="col-lg-6"><h3>Added files <span class="fileUpload btn btn-default glyphicon glyphicon-plus"><input class="upload" type="file" multiple="multiple" ngf-select ng-model="vm.addedFile"></span></h3><h6 style="font-style: italic;">Press the '+' button to add files</h6></div><div class="col-lg-6 text-right"><br><span class="fileUpload"><input class="upload" type="file" ngf-select ng-model="vm.archive" ngf-change="vm.saveBundleArchive()"> <a href="">Archive import</a></span></div></div><div class="col-lg-12"><form id="addedBundleFiles_form" name="addedBundleFiles_form"><table class="table table-striped"><colgroup ng-if="vm.addedBundleFiles.length > 0"><col width="20%"/><col width="65%"/><col width="10%"/><col width="5%"/></colgroup><thead ng-if="vm.addedBundleFiles.length > 0"><tr><th>Name</th><th>Relative path <span class="glyphicon glyphicon-question-sign" title="If necessary, specify folders where the file should be placed, e.g. 'folder1/folder2'"></span></th><th class="text-center">Size</th><th></th></tr></thead><tbody><tr ng-repeat="bundleFile in vm.addedBundleFiles"><td>{{::bundleFile.file.name}}</td><td><input type="text" class="form-control" id="addedBundleFile_{{$index}}" name="addedBundleFile_{{$index}}" ng-model="bundleFile.relativePath" ng-maxlength="100" ng-pattern='/^([^:|*?"<>\\\/]|\/(?!\/))+$/'> <span class="error" ng-show="addedBundleFiles_form.addedBundleFile_{{$index}}.$error.maxlength">Maximum length should not exceed 100 characters</span> <span class="error" ng-show="addedBundleFiles_form.addedBundleFile_{{$index}}.$error.pattern">String contains invalid characters</span></td><td class="text-center">{{::bundleFile.file.size | numeraljs:'0 b'}}</td><td class="text-center"><button class="btn btn-default glyphicon glyphicon-minus" ng-click="vm.cancelAddedBundleFile($index)"></button></td></tr><tr ng-if="vm.addedBundleFiles.length == 0"><td>Files not selected</td></tr></tbody></table></form></div><div class="col-lg-12" ng-if="vm.removedBundleFiles.length > 0"><h3>Removed files</h3><table class="table table-striped"><colgroup><col width="85%"/><col width="10%"/><col width="5%"/></colgroup><thead><tr><th>Name</th><th class="text-center">Size</th><th class="text-center"></th></tr></thead><tbody><tr ng-repeat="file in vm.removedBundleFiles"><td ng-if="file.url"><a href="{{file.url}}">{{::file.key}}</a></td><td ng-if="!file.url">{{::file.key}}</td><td class="text-center">{{::file.size | numeraljs:'0 b'}}</td><td class="text-center"><button class="btn btn-default glyphicon glyphicon-minus" ng-click="vm.restoreBundleFile($index)"></button></td></tr></tbody></table></div><div class="col-lg-12"><div class="col-sm-offset-4 col-sm-2 col-xs-offset-5 col-xs-3 text-center"><button class="btn btn-block vhs-green vhs-white-text" type="button" ng-click="vm.saveBundleFiles()" ng-disabled="!addedBundleFiles_form.$valid || vm.bundleFilesSaving">Save</button></div><div class="col-sm-2 col-xs-3 text-center"><button class="btn btn-block vhs-brown vhs-white-text" type="button" ng-click="vm.loadBundleForm()">Cancel</button></div></div><div class="col-lg-12"><h3>Existing files <button class="btn btn-default glyphicon glyphicon-refresh" type="button" ng-click="vm.refreshBundleFiles()"></button></h3><div vhs-grid data-grid-model-path="vm.bundleFilesGridModel" data-vhs-grid-uuid="bundleFilesRegisterGrid" ng-if="vm.bundleFilesGridModel"><div class="form-inline form-header material-form-header pull-right" data-vhs-auto-search><label for="searchQuizField1" class="label-search">The total number of records: {{vm.bundleFilesGridModel.totalCount}}</label> <span class="glyphicon glyphicon-search" aria-hidden="true" data-toggle="collapse" data-target="#searchQuizField1" aria-expanded="false" aria-controls="collapseExample"></span> <input type="text" class="form-control" id="searchQuizField1" maxlength="500" placeholder="Search" ng-model="vm.bundleFilesGridModel.filter.searchString"/></div><div><table class="table table-striped" ng-if="vm.bundleFilesGridModel.entries.length > 0"><colgroup><col width="80%"/><col width="5%"/><col width="10%"/><col width="5%"/></colgroup><thead><tr><th>Name</th><th class="text-center">Load at start</th><th class="text-center">Size</th><th class="text-center"></th></tr></thead><tbody><tr ng-repeat="file in vm.bundleFilesGridModel.entries"><td ng-if="file.url"><a href="{{file.url}}">{{::file.key}}</a></td><td ng-if="!file.url">{{::file.key}}</td><td class="text-center"><input type="checkbox" ng-if="file.type == 'CSS' || file.type == 'JS'" ng-checked="file.loadAtStart" ng-click="vm.changeBundleFileLoadAtStartValue(file)"/> <span ng-if="file.type != 'CSS' && file.type != 'JS'">No</span></td><td class="text-center">{{::file.size | numeraljs:'0 b'}}</td><td class="text-center"><button class="btn btn-default glyphicon glyphicon-minus" ng-click="vm.removeBundleFile($index)"></button></td></tr></tbody></table></div><div vhs-grid-empty data-vhs-empty-message="Files not found"></div><div class="row" vhs-grid-pagination></div></div></div></div><div class="text-center" ng-show="vm.archiveUploading"><br><p style="font-style: italic;">Uploading... Don't leave this page</p><br></div></div><div class="modal fade" id="creationDialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" ng-if="vm.creationKey === vm.MODULE">Module creation</h4><h4 class="modal-title" ng-if="vm.creationKey === vm.SECTION">Section creation</h4></div><div class="modal-body"><form class="form-horizontal" id="creation_form" name="creation_form"><div class="form-group" ng-if="vm.creationKey === vm.MODULE"><label class="col-sm-4 col-xs-4 control-label vhs-required">Module name</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="moduleNameField" name="moduleNameField" ng-model="vm.module.name" maxlength="255" required> <span class="error" ng-show="creation_form.moduleNameField.$error.required">Please specify a module name.</span></div></div><div ng-if="vm.creationKey === vm.SECTION"><div class="form-group"><label class="col-sm-4 col-xs-4 control-label vhs-required">Section name</label><div class="col-sm-8 col-xs-8 pull-right"><input type="text" class="form-control" id="sectionNameField" name="sectionNameField" ng-model="vm.section.name" maxlength="255" required> <span class="error" ng-show="creation_form.sectionNameField.$error.required">Please specify a section name.</span></div></div><div class="form-group"><label class="col-sm-4 col-xs-4 control-label vhs-required">Section type</label><div class="col-sm-8 col-xs-8 pull-right"><select class="form-control" id="sectionTypeField" name="sectionTypeField" ng-model="vm.typeKey" ng-required="true"><option value="0">Information</option><option value="1">Quiz</option></select> <span class="error" ng-show="creation_form.sectionTypeField.$error.required">Please specify a section type.</span></div></div><div class="form-group"><label class="col-sm-4 col-xs-4 control-label">Parent section</label><div class="col-sm-8 col-xs-8 pull-right"><select class="form-control" id="parentSectionField" name="parentSectionField" ng-model="vm.section.parentId" ng-options="::s.section.id as ::s.section.name for s in vm.availableSectionParent.get(vm.moduleId)"></select></div></div></div></form></div><div class="modal-footer"><button class="btn vhs-green-text pull-right" data-dismiss="modal" type="button" ng-click="vm.cleanCreationModal()">Cancel</button> <button class="btn vhs-green vhs-white-text" type="button" ng-disabled="!creation_form.$valid" ng-click="vm.createModuleOrSection()" data-dismiss="modal">Save</button></div></div></div></div><div class="modal fade" id="removalDialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><div ng-if="vm.creationKey === vm.MODULE">Remove module «{{vm.module.name}}»?</div><div ng-if="vm.creationKey === vm.SECTION"><p>Remove section «{{vm.section.name}}»?</p></div><div ng-if="vm.creationKey === vm.SECTION"><label><input type="checkbox" ng-model="vm.removeCurrentUserSectionProgress"> Remove section progress for current user</label></div></div><div class="modal-footer"><button type="button" class="btn vhs-green vhs-white-text" ng-show="!vm.disabledRemoveModuleButton" ng-if="vm.creationKey === vm.MODULE" ng-click="vm.removeModule(vm.module)" data-dismiss="modal">Yes</button> <button type="button" class="btn vhs-green vhs-white-text" ng-show="!vm.disabledRemoveSectionButton" ng-if="vm.creationKey === vm.SECTION" ng-click="vm.removeSection(vm.section)" data-dismiss="modal">Yes</button> <button type="button" class="btn btn-default" data-dismiss="modal">No</button></div></div></div></div><div class="modal fade" id="editingDialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">Edit section</h4></div><div class="modal-body"><form class="form-horizontal" id="editing_form" name="editing_form"><div class="form-group"><label class="col-sm-4 col-xs-4 control-label">Parent section</label><div class="col-sm-8 col-xs-8 pull-right"><select ng-if="vm.editingSection.id" class="form-control" id="parentSectionField" name="parentSectionField" ng-model="vm.editingSection.parentId" ng-options="::s.id as ::s.name for s in vm.availableCurrentSectionParent"><option value=""></option></select></div></div></form></div><div class="modal-footer"><button class="btn vhs-green-text pull-right" data-dismiss="modal" type="button" ng-click="vm.cleanEditingModal()">Cancel</button> <button class="btn vhs-green vhs-white-text" type="button" ng-disabled="!editing_form.$valid" ng-click="vm.editSectionParent()" data-dismiss="modal">Save</button></div></div></div></div></div>