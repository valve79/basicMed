<div ng-controller="users.UserEditController as vm"><div class="content-header"></div><form name="user_form" class="common-form" ng-submit="vm.save()"><div class="row"><div class="col-lg-6 col-xs-6"><div class="form-group"><label class="vhs-required" for="firstNameField">First Name</label> <input type="text" class="form-control" id="firstNameField" name="firstNameField" required ng-disabled="vm.isEverythingDisabled" maxlength="100" ng-model="vm.user.firstName"> <span class="error" ng-show="user_form.firstNameField.$error.required">Please specify the user’s first name</span></div><div class="form-group"><label class="vhs-required" for="lastNameField">Last Name</label> <input type="text" class="form-control" id="lastNameField" name="lastNameField" required ng-disabled="vm.isEverythingDisabled" maxlength="100" ng-model="vm.user.lastName"> <span class="error" ng-show="user_form.lastNameField.$error.required">Please specify the user’s last name</span></div><div class="form-group"><label class="vhs-required" for="mailField">Email</label> <input type="email" class="form-control" id="mailField" name="mailField" required ng-disabled="vm.isEverythingDisabled" maxlength="100" ng-model="vm.user.email"><div class="error" ng-show="user_form.mailField.$error.required">Please specify an email address</div><div class="error" ng-show="user_form.mailField.$error.email">Please specify a valid email, e.g.&nbsp; j.smith@example.com</div></div><div class="form-group" ng-if="vm.availableLocales && vm.availableLocales.length > 1"><label for="locateField" class="vhs-required">Locale</label> <select id="locateField" class="form-control" ng-disabled="vm.isEverythingDisabled" ng-model="vm.user.locale" ng-required="true" ng-options="::e.locale as ::e.name for e in ::vm.availableLocales"></select></div><div class="form-group filter" ng-if="vm.logonProvidersForAdd.length > 0"><div class="btn-group"><button aria-expanded="true" data-toggle="dropdown" class="btn btn-primary dropdown-toggle" type="button">Add user login <span class="caret"></span></button><ul role="menu" class="dropdown-menu"><li role="presentation" ng-repeat="provider in vm.logonProvidersForAdd"><a ng-click="vm.addUserLogon(provider.key)">{{::vm.getLogonProviderName(provider.key)}}</a></li></ul></div></div><div ng-repeat="logon in vm.user.userLogons" class="panel panel-primary logon-provider-panel"><div class="panel-heading">{{::vm.getLogonProviderName(logon.providerKey)}} <a class="trash pull-right" title="Remove" ng-click="vm.removeUserLogon(logon.providerKey)"></a></div><div class="panel-body"><label><input type="checkbox" ng-model="logon.isActive"> Is active</label><div class="form-group"><label class="vhs-required" for="loginField_{{logon.providerKey}}">Login</label> <input type="text" class="form-control" id="loginField_{{logon.providerKey}}" name="loginField_{{logon.providerKey}}" required maxlength="100" ng-model="logon.name"> <span class="error" ng-show="user_form.loginField_{{logon.providerKey}}.$error.required">Please specify a username (login)</span></div><input type="text" style="display:none"><div class="form-group" ng-if="logon.providerKey == 'LOCAL'"><label ng-class="{'vhs-required': !vm.user.id}" for="passwordField_{{logon.providerKey}}">Password</label> <input type="password" class="form-control" id="passwordField_{{logon.providerKey}}" name="passwordField_{{logon.providerKey}}" maxlength="100" ng-required="!vm.user.id" ng-model="logon.password"> <span class="error" ng-show="user_form.passwordField_{{logon.providerKey}}.$error.required">Please specify a password</span></div><div class="form-group" ng-if="logon.providerKey == 'LOCAL'"><label ng-class="{'vhs-required': !vm.user.id || logon.password.length}" for="confirmPasswordField_{{logon.providerKey}}">Confirm Password</label> <input type="password" class="form-control" id="confirmPasswordField_{{logon.providerKey}}" name="confirmPasswordField_{{logon.providerKey}}" maxlength="100" ng-required="logon.password.length" ng-model="logon.confirmPassword"> <span class="error" ng-show="!logon.confirmPassword.length && user_form.confirmPasswordField_{{logon.providerKey}}.$error.required">Please re-enter the same password</span> <span class="error" ng-show="logon.confirmPassword.length && logon.confirmPassword != logon.password">Passwords do not match</span></div></div></div></div><div class="col-lg-6 col-xs-6"><div class="form-group"><label>Groups</label><table class="table"><tbody><tr ng-repeat="group in vm.user.groupsList"><td>{{group.name}}</td><td><button class="btn btn-default btn-sm" type="button" ng-if="!vm.activeGroup && group.canBeRemoved" ng-disabled="vm.isEverythingDisabled" ng-click="vm.deleteGroup(group.id)"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Remove</button></td></tr></tbody></table></div><div class="row"><div class="col-lg-6 col-xs-6"><button class="btn btn-primary btn-block" type="button" ng-disabled="vm.isEverythingDisabled" ng-click="vm.showGroups()" ng-show="!vm.activeGroup">Modify</button> <button class="btn btn-primary btn-block" type="button" ng-disabled="true" ng-show="vm.activeGroup">Modification<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></button></div></div><div ng-if="vm.activeGroup"><div class="panel panel-primary"><div class="panel-heading">Modification of groups for the user ‘{{vm.user.fullName}}’</div><div class="panel-body"><table class="table" data-vhs-table><thead><tr><th>&nbsp;</th><th>Group</th></tr></thead><tbody><tr ng-repeat="group in vm.groups"><td><span class="glyphicon glyphicon-check" aria-hidden="true" ng-if="group.selected && group.canBeRemoved" ng-click="vm.unselectGroup($index)"></span> <span class="glyphicon glyphicon-ok" aria-hidden="true" ng-if="group.selected && !group.canBeRemoved"></span> <span class="glyphicon glyphicon-unchecked" aria-hidden="true" ng-if="!group.selected" ng-click="vm.selectGroup($index)"></span></td><td>{{::group.name}}</td></tr><tr ng-hide="vm.groups.length > 0"><td colspan="2">Groups not found</td></tr></tbody></table><div vhs-grid-pagination></div><p><button class="btn btn-default pull-right" type="button" ng-disabled="vm.isEverythingDisabled" ng-click="vm.closeGroups()">Close</button> <button class="btn btn-default pull-right" type="button" ng-disabled="vm.isEverythingDisabled" ng-click="vm.clearSelection()">Cancel</button> <button class="btn btn-primary pull-right" type="button" ng-disabled="vm.isEverythingDisabled" ng-click="vm.addGroups()">Modify</button></p></div></div></div></div></div><div class="row"><div class="col-lg-6 col-xs-6"><div class="row"><div class="col-lg-6 col-xs-6"><button class="btn btn-primary btn-block" type="submit" ng-disabled="vm.isEverythingDisabled || !user_form.$valid || vm.disableSaveButton || vm.confirmPassword != vm.user.password">Save</button></div><div class="col-lg-6 col-xs-6"><a ng-href="#{{::vm.usersRouter.indexUrl()}}" class="btn btn-default btn-block">Cancel</a></div></div></div><div class="col-lg-6 col-xs-6"><div class="row"><div class="col-lg-6 col-xs-6"><button class="btn btn-primary btn-block" type="button" ng-click="vm.deactivate()" ng-disabled="vm.isEverythingDisabled" ng-if="vm.user.id && vm.user.isActive && vm.isDeactivationAllowed && vm.systemPermissions.removeUser"><span class="glyphicon glyphicon-off"></span> Deactivate</button></div><div class="col-lg-6 col-xs-6"><button class="btn btn-primary btn-block" type="button" ng-click="vm.requestPasswordRestore()" ng-disabled="vm.isEverythingDisabled" ng-if="vm.user.id && vm.user.isActive && vm.systemPermissions.editUser">Reset password</button></div></div></div></div></form><div class="modal fade" id="resetPasswordLinkDialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><p>Send this link to the user for password reset:<br/>{{vm.resetPasswordLink}}</p></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button></div></div></div></div></div>